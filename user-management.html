<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>× ×™×”×•×œ ××©×ª××©×™× - ××¢×¨×›×ª × ×™×”×•×œ ×‘×’×“×—×¦"×</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Heebo', sans-serif;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-gray-800 min-h-screen">
    
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-orange-500"></div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="hidden">
        <!-- Header -->
        <div class="bg-gradient-to-r from-orange-600 to-orange-700 shadow-2xl">
            <div class="max-w-7xl mx-auto px-4 py-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-white">ğŸ‘¥ × ×™×”×•×œ ××©×ª××©×™×</h1>
                        <p class="text-orange-200 mt-1">×”×•×¡×¤×” ×•×¢×¨×™×›×ª ××©×ª××©×™× ×•×”×¨×©××•×ª</p>
                    </div>
                    <button onclick="window.location.href='index-secure.html'" 
                            class="bg-white text-orange-600 px-6 py-2 rounded-lg font-bold hover:bg-orange-50 transition-all">
                        ×—×–×¨×” ×œ×“×£ ×”×‘×™×ª
                    </button>
                </div>
            </div>
        </div>

        <div class="max-w-7xl mx-auto px-4 py-8">
            
            <!-- Add User Card -->
            <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                    <span>â•</span>
                    <span>×”×•×¡×£ ××©×ª××© ×—×“×©</span>
                </h2>

                <form id="addUserForm" class="grid md:grid-cols-2 gap-6">
                    <!-- Username -->
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">×©× ××©×ª××© *</label>
                        <input type="text" id="newUsername" required
                               class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-orange-500 focus:ring-4 focus:ring-orange-200 transition-all"
                               placeholder="×”×–×Ÿ ×©× ××©×ª××© ×™×™×—×•×“×™">
                    </div>

                    <!-- Password -->
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">×¡×™×¡××” *</label>
                        <input type="password" id="newPassword" required
                               class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-orange-500 focus:ring-4 focus:ring-orange-200 transition-all"
                               placeholder="×”×–×Ÿ ×¡×™×¡××”">
                    </div>

                    <!-- Full Name -->
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">×©× ××œ× *</label>
                        <input type="text" id="newFullName" required
                               class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-orange-500 focus:ring-4 focus:ring-orange-200 transition-all"
                               placeholder="×©× ×¤×¨×˜×™ ×•××©×¤×—×”">
                    </div>

                    <!-- Email -->
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">××™××™×™×œ</label>
                        <input type="email" id="newEmail"
                               class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-orange-500 focus:ring-4 focus:ring-orange-200 transition-all"
                               placeholder="example@example.com">
                    </div>

                    <!-- Personal Number -->
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">××¡×¤×¨ ××™×©×™</label>
                        <input type="text" id="newPersonalNumber" maxlength="7"
                               class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-orange-500 focus:ring-4 focus:ring-orange-200 transition-all"
                               placeholder="7 ×¡×¤×¨×•×ª">
                    </div>

                    <!-- Role -->
                    <div>
                        <label class="block text-gray-700 font-bold mb-2">×ª×¤×§×™×“ *</label>
                        <select id="newRole" required
                                class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-orange-500 focus:ring-4 focus:ring-orange-200 transition-all">
                            <option value="">×‘×—×¨ ×ª×¤×§×™×“...</option>
                            <option value="admin">ğŸ‘‘ ×× ×”×œ ××¢×¨×›×ª</option>
                            <option value="operator">ğŸ”§ ××¤×¢×™×œ</option>
                            <option value="viewer">ğŸ‘ï¸ ×¦×•×¤×”</option>
                            <option value="user">ğŸ‘¤ ××©×ª××©</option>
                        </select>
                    </div>

                    <!-- Submit Button -->
                    <div class="md:col-span-2">
                        <button type="submit" id="addUserBtn"
                                class="w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white font-bold py-4 rounded-xl hover:from-orange-600 hover:to-orange-700 transition-all transform hover:scale-105 shadow-lg">
                            <span id="addUserBtnText">â• ×”×•×¡×£ ××©×ª××©</span>
                            <span id="addUserBtnLoader" class="hidden">××•×¡×™×£...</span>
                        </button>
                    </div>
                </form>

                <!-- Message -->
                <div id="addUserMessage" class="hidden mt-4 p-4 rounded-lg"></div>
            </div>

            <!-- Role Descriptions -->
            <div class="bg-white rounded-2xl shadow-2xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ“‹ ×ª×™××•×¨ ×ª×¤×§×™×“×™× ×•×”×¨×©××•×ª</h2>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Admin -->
                    <div class="bg-gradient-to-br from-red-50 to-red-100 p-6 rounded-xl border-2 border-red-300">
                        <div class="flex items-center gap-3 mb-3">
                            <span class="text-3xl">ğŸ‘‘</span>
                            <h3 class="text-xl font-bold text-red-800">×× ×”×œ ××¢×¨×›×ª</h3>
                        </div>
                        <ul class="space-y-2 text-red-700">
                            <li class="flex items-start gap-2">
                                <span>âœ“</span>
                                <span>×”×¨×©××•×ª ××œ××•×ª ×œ×›×œ ×”××¢×¨×›×ª</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span>âœ“</span>
                                <span>× ×™×”×•×œ ××©×ª××©×™× ×•×”×¨×©××•×ª</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span>âœ“</span>
                                <span>×¦×¤×™×™×” ×‘×™×•××Ÿ ×‘×™×§×•×¨×ª ××œ×</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span>âœ“</span>
                                <span>××—×™×§×ª ×•×¢×¨×™×›×ª ×¨×©×•××•×ª</span>
                            </li>
                        </ul>
                    </div>

                    <!-- Operator -->
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-xl border-2 border-blue-300">
                        <div class="flex items-center gap-3 mb-3">
                            <span class="text-3xl">ğŸ”§</span>
                            <h3 class="text-xl font-bold text-blue-800">××¤×¢×™×œ</h3>
                        </div>
                        <ul class="space-y-2 text-blue-700">
                            <li class="flex items-start gap-2">
                                <span>âœ“</span>
                                <span>×§×¨×™××” ×•×›×ª×™×‘×” ×©×œ × ×ª×•× ×™×</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span>âœ“</span>
                                <span>×¦×¤×™×™×” ×‘×“×•×—×•×ª</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span>âœ“</span>
                                <span>×”×–× ×ª ×—×ª×™××•×ª</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span>Ã—</span>
                                <span>××™×Ÿ ×’×™×©×” ×œ× ×™×”×•×œ ××©×ª××©×™×</span>
                            </li>
                        </ul>
                    </div>

                    <!-- Viewer -->
                    <div class="bg-gradient-to-br from-green-50 to-green-100 p-6 rounded-xl border-2 border-green-300">
                        <div class="flex items-center gap-3 mb-3">
                            <span class="text-3xl">ğŸ‘ï¸</span>
                            <h3 class="text-xl font-bold text-green-800">×¦×•×¤×”</h3>
                        </div>
                        <ul class="space-y-2 text-green-700">
                            <li class="flex items-start gap-2">
                                <span>âœ“</span>
                                <span>×§×¨×™××” ×‘×œ×‘×“</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span>âœ“</span>
                                <span>×¦×¤×™×™×” ×‘×“×•×—×•×ª</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span>Ã—</span>
                                <span>××™×Ÿ ××¤×©×¨×•×ª ×œ×”×–×™×Ÿ × ×ª×•× ×™×</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span>Ã—</span>
                                <span>××™×Ÿ ×’×™×©×” ×œ××¢×¨×›×•×ª ×—×ª×™××”</span>
                            </li>
                        </ul>
                    </div>

                    <!-- User -->
                    <div class="bg-gradient-to-br from-gray-50 to-gray-100 p-6 rounded-xl border-2 border-gray-300">
                        <div class="flex items-center gap-3 mb-3">
                            <span class="text-3xl">ğŸ‘¤</span>
                            <h3 class="text-xl font-bold text-gray-800">××©×ª××©</h3>
                        </div>
                        <ul class="space-y-2 text-gray-700">
                            <li class="flex items-start gap-2">
                                <span>âœ“</span>
                                <span>×›×ª×™×‘×” ×‘×œ×‘×“</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span>âœ“</span>
                                <span>×”×–× ×ª ×—×ª×™××•×ª ××™×©×™×•×ª</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span>Ã—</span>
                                <span>××™×Ÿ ×’×™×©×” ×œ×“×•×—×•×ª</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <span>Ã—</span>
                                <span>××™×Ÿ ×™×›×•×œ×ª ×œ×§×¨×•× × ×ª×•× ×™× ××—×¨×™×</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Auth Client Library -->
    <script src="auth-client.js"></script>

    <script>
        // ============================================================
        // CONFIGURATION
        // ============================================================
        
        const API_URL = 'https://script.google.com/macros/s/AKfycbwQqMrKxHnA5VCnm_sBE9qFdmOhi1zfcumAXPHQmE3AVv0PVkd5ad_QboOjN2B4G7IzLQ/exec';
        
        // ============================================================
        // INITIALIZATION
        // ============================================================
        
        const authClient = new SecureAuthClient(API_URL);
        const authGuard = new AuthGuard(authClient, 'manage_users');
        
        // ============================================================
        // PAGE LOAD
        // ============================================================
        
        window.addEventListener('DOMContentLoaded', async () => {
            const isAuthorized = await authGuard.checkAuth();
            
            if (isAuthorized) {
                document.getElementById('loadingOverlay').style.display = 'none';
                document.getElementById('mainContent').classList.remove('hidden');
                setupEventListeners();
            }
        });
        
        // ============================================================
        // EVENT LISTENERS
        // ============================================================
        
        function setupEventListeners() {
            document.getElementById('addUserForm').addEventListener('submit', handleAddUser);
        }
        
        // ============================================================
        // ADD USER
        // ============================================================
        
        async function handleAddUser(e) {
            e.preventDefault();
            
            const userData = {
                username: document.getElementById('newUsername').value.trim(),
                password: document.getElementById('newPassword').value,
                fullName: document.getElementById('newFullName').value.trim(),
                email: document.getElementById('newEmail').value.trim(),
                personalNumber: document.getElementById('newPersonalNumber').value.trim(),
                role: document.getElementById('newRole').value
            };
            
            // Validation
            if (!userData.username || !userData.password || !userData.fullName || !userData.role) {
                showMessage('error', '× × ×œ××œ× ××ª ×›×œ ×”×©×“×•×ª ×”×—×•×‘×”');
                return;
            }
            
            if (userData.username.length < 3) {
                showMessage('error', '×©× ×”××©×ª××© ×—×™×™×‘ ×œ×”×™×•×ª ×œ×¤×—×•×ª 3 ×ª×•×•×™×');
                return;
            }
            
            if (userData.password.length < 6) {
                showMessage('error', '×”×¡×™×¡××” ×—×™×™×‘×ª ×œ×”×™×•×ª ×œ×¤×—×•×ª 6 ×ª×•×•×™×');
                return;
            }
            
            // Show loading
            const btn = document.getElementById('addUserBtn');
            const btnText = document.getElementById('addUserBtnText');
            const btnLoader = document.getElementById('addUserBtnLoader');
            
            btn.disabled = true;
            btnText.classList.add('hidden');
            btnLoader.classList.remove('hidden');
            
            try {
                const result = await authClient.createUser(userData);
                
                if (result.success) {
                    showMessage('success', 'âœ“ ×”××©×ª××© × ×•×¡×£ ×‘×”×¦×œ×—×”!');
                    document.getElementById('addUserForm').reset();
                } else {
                    showMessage('error', '×©×’×™××” ×‘×”×•×¡×¤×ª ×”××©×ª××©');
                }
            } catch (error) {
                console.error('Error creating user:', error);
                showMessage('error', error.message || '×©×’×™××” ×‘×”×•×¡×¤×ª ×”××©×ª××©');
            } finally {
                btn.disabled = false;
                btnText.classList.remove('hidden');
                btnLoader.classList.add('hidden');
            }
        }
        
        // ============================================================
        // UTILITY FUNCTIONS
        // ============================================================
        
        function showMessage(type, message) {
            const messageDiv = document.getElementById('addUserMessage');
            messageDiv.classList.remove('hidden', 'bg-red-50', 'bg-green-50', 'border-red-300', 'border-green-300', 'text-red-700', 'text-green-700');
            
            if (type === 'success') {
                messageDiv.classList.add('bg-green-50', 'border-2', 'border-green-300', 'text-green-700');
            } else {
                messageDiv.classList.add('bg-red-50', 'border-2', 'border-red-300', 'text-red-700');
            }
            
            messageDiv.textContent = message;
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                messageDiv.classList.add('hidden');
            }, 5000);
        }
    </script>
</body>
</html>
